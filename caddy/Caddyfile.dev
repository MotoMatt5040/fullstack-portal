{
    # Disable HTTPS for local development
    auto_https off
}

:80 {
    encode gzip

    # Auth service routes - login, logout, refresh, password reset
    handle /api/auth/* {
        reverse_proxy auth:5001
    }
    handle /api/refresh {
        reverse_proxy auth:5001
    }
    handle /api/reset/* {
        reverse_proxy auth:5001
    }

    # Notification service routes - SSE events, broadcasts, support
    handle /api/notifications/* {
        reverse_proxy notifications:5002
    }
    handle /api/support/* {
        reverse_proxy notifications:5002
    }

    # Project numbering service routes
    handle /api/project-numbering/* {
        reverse_proxy projects:5003
    }
    handle /api/project-numbering {
        reverse_proxy projects:5003
    }

    # All other API routes go to the monolith
    handle /api/* {
        reverse_proxy api:5000
    }

    # Frontend
    handle {
        reverse_proxy client:5173
    }
}
